<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Strategy Builder</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .condition-group { background: #f9f9f9; padding: 10px; margin: 5px 0; border-radius: 3px; }
        select, input { padding: 5px; margin: 2px; }
        button { padding: 8px 15px; margin: 5px; cursor: pointer; }
        .remove-btn { background: #ff4444; color: white; border: none; border-radius: 3px; }
        .add-btn { background: #4CAF50; color: white; border: none; border-radius: 3px; }
        .output { background: #f0f0f0; padding: 15px; margin-top: 20px; border-radius: 5px; }
        .inline { display: inline-block; margin-right: 10px; }
    </style>
</head>
<body>
    <h1>Trading Strategy Builder</h1>
    
    <form id="strategyForm">
        <!-- Buy Conditions -->
        <div class="section">
            <h3>Buy Conditions (ALL must be true)</h3>
            <div id="buyConditions">
                <div class="condition-group">
                    <select name="buy_indicator[]">
                        <option value="EMA">EMA</option>
                        <option value="SMA">SMA</option>
                        <option value="RSI">RSI</option>
                        <option value="ROC">ROC</option>
                        <option value="PRICE">Price</option>
                    </select>
                    <input type="number" name="buy_param1[]" placeholder="Period/Value" min="1">
                    <select name="buy_operator[]">
                        <option value=">">></option>
                        <option value="<"><</option>
                        <option value=">=">>=</option>
                        <option value="<="><=</option>
                        <option value="==">==</option>
                        <option value="crosses_above">Crosses Above</option>
                        <option value="crosses_below">Crosses Below</option>
                    </select>
                    <select name="buy_compare_type[]">
                        <option value="indicator">Indicator</option>
                        <option value="value">Fixed Value</option>
                    </select>
                    <select name="buy_compare_indicator[]">
                        <option value="EMA">EMA</option>
                        <option value="SMA">SMA</option>
                        <option value="RSI">RSI</option>
                        <option value="ROC">ROC</option>
                        <option value="PRICE">Price</option>
                    </select>
                    <input type="number" name="buy_compare_param[]" placeholder="Period/Value">
                    <input type="number" name="buy_compare_value[]" placeholder="Fixed Value" style="display:none;">
                    <button type="button" class="remove-btn" onclick="removeCondition(this)">Remove</button>
                </div>
            </div>
            <button type="button" class="add-btn" onclick="addBuyCondition()">Add Buy Condition</button>
        </div>

        <!-- Sell Conditions -->
        <div class="section">
            <h3>Sell Conditions (ANY can trigger)</h3>
            <div id="sellConditions">
                <div class="condition-group">
                    <select name="sell_indicator[]">
                        <option value="EMA">EMA</option>
                        <option value="SMA">SMA</option>
                        <option value="RSI">RSI</option>
                        <option value="ROC">ROC</option>
                        <option value="PRICE">Price</option>
                    </select>
                    <input type="number" name="sell_param1[]" placeholder="Period/Value" min="1">
                    <select name="sell_operator[]">
                        <option value=">">></option>
                        <option value="<"><</option>
                        <option value=">=">>=</option>
                        <option value="<="><=</option>
                        <option value="==">==</option>
                        <option value="crosses_above">Crosses Above</option>
                        <option value="crosses_below">Crosses Below</option>
                    </select>
                    <select name="sell_compare_type[]">
                        <option value="indicator">Indicator</option>
                        <option value="value">Fixed Value</option>
                    </select>
                    <select name="sell_compare_indicator[]">
                        <option value="EMA">EMA</option>
                        <option value="SMA">SMA</option>
                        <option value="RSI">RSI</option>
                        <option value="ROC">ROC</option>
                        <option value="PRICE">Price</option>
                    </select>
                    <input type="number" name="sell_compare_param[]" placeholder="Period/Value">
                    <input type="number" name="sell_compare_value[]" placeholder="Fixed Value" style="display:none;">
                    <button type="button" class="remove-btn" onclick="removeCondition(this)">Remove</button>
                </div>
            </div>
            <button type="button" class="add-btn" onclick="addSellCondition()">Add Sell Condition</button>
        </div>

        <!-- Risk Management -->
        <div class="section">
            <h3>Risk Management</h3>
            <div class="inline">
                <label>Stop Loss %: <input type="number" name="stop_loss" step="0.1" min="0" max="50" placeholder="5.0"></label>
            </div>
            <div class="inline">
                <label>Take Profit %: <input type="number" name="take_profit" step="0.1" min="0" max="100" placeholder="10.0"></label>
            </div>
        </div>

        <!-- Strategy Settings -->
        <div class="section">
            <h3>Strategy Settings</h3>
            <div class="inline">
                <label>Strategy Name: <input type="text" name="strategy_name" placeholder="My Strategy" required></label>
            </div>
            <div class="inline">
                <label>Max Positions: <input type="number" name="max_positions" min="1" max="10" value="1"></label>
            </div>
        </div>

        <!-- Stock Selection -->
        <div class="section">
            <h3>Stock Selection</h3>
            <div class="inline">
                <label>Stock Symbol: <input type="text" name="stock_symbol" value="AMZN" placeholder="AMZN" required></label>
            </div>
        </div>

        <button type="button" onclick="generateStrategy()">Generate Strategy JSON</button>
    </form>

    <div class="output">
        <h3>Generated Strategy JSON:</h3>
        <pre id="output"></pre>
    </div>

    <script>
        function addBuyCondition() {
            const container = document.getElementById('buyConditions');
            const template = container.children[0].cloneNode(true);
            template.querySelectorAll('input').forEach(input => input.value = '');
            template.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
            container.appendChild(template);
        }

        function addSellCondition() {
            const container = document.getElementById('sellConditions');
            const template = container.children[0].cloneNode(true);
            template.querySelectorAll('input').forEach(input => input.value = '');
            template.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
            container.appendChild(template);
        }

        function removeCondition(button) {
            const container = button.closest('#buyConditions, #sellConditions');
            if (container.children.length > 1) {
                button.closest('.condition-group').remove();
            }
        }

        document.addEventListener('change', function(e) {
            if (e.target.name && e.target.name.includes('compare_type')) {
                const group = e.target.closest('.condition-group');
                const valueInput = group.querySelector('input[name*="compare_value"]');
                const indicatorSelect = group.querySelector('select[name*="compare_indicator"]');
                const paramInput = group.querySelector('input[name*="compare_param"]');
                
                if (e.target.value === 'value') {
                    valueInput.style.display = 'inline';
                    indicatorSelect.style.display = 'none';
                    paramInput.style.display = 'none';
                } else {
                    valueInput.style.display = 'none';
                    indicatorSelect.style.display = 'inline';
                    paramInput.style.display = 'inline';
                }
            }
        });

        function generateStrategy() {
            const form = document.getElementById('strategyForm');
            const formData = new FormData(form);
            
            const strategy = {
                name: formData.get('strategy_name'),
                stock_symbol: formData.get('stock_symbol'),
                max_positions: parseInt(formData.get('max_positions')) || 1,
                stop_loss: parseFloat(formData.get('stop_loss')) || null,
                take_profit: parseFloat(formData.get('take_profit')) || null,
                buy_conditions: [],
                sell_conditions: []
            };

            const buyIndicators = formData.getAll('buy_indicator[]');
            const buyParams = formData.getAll('buy_param1[]');
            const buyOperators = formData.getAll('buy_operator[]');
            const buyCompareTypes = formData.getAll('buy_compare_type[]');
            const buyCompareIndicators = formData.getAll('buy_compare_indicator[]');
            const buyCompareParams = formData.getAll('buy_compare_param[]');
            const buyCompareValues = formData.getAll('buy_compare_value[]');

            for (let i = 0; i < buyIndicators.length; i++) {
                const condition = {
                    indicator: buyIndicators[i],
                    param: parseInt(buyParams[i]) || null,
                    operator: buyOperators[i],
                    compare_type: buyCompareTypes[i]
                };

                if (buyCompareTypes[i] === 'value') {
                    condition.compare_value = parseFloat(buyCompareValues[i]);
                } else {
                    condition.compare_indicator = buyCompareIndicators[i];
                    condition.compare_param = parseInt(buyCompareParams[i]) || null;
                }

                strategy.buy_conditions.push(condition);
            }

            const sellIndicators = formData.getAll('sell_indicator[]');
            const sellParams = formData.getAll('sell_param1[]');
            const sellOperators = formData.getAll('sell_operator[]');
            const sellCompareTypes = formData.getAll('sell_compare_type[]');
            const sellCompareIndicators = formData.getAll('sell_compare_indicator[]');
            const sellCompareParams = formData.getAll('sell_compare_param[]');
            const sellCompareValues = formData.getAll('sell_compare_value[]');

            for (let i = 0; i < sellIndicators.length; i++) {
                const condition = {
                    indicator: sellIndicators[i],
                    param: parseInt(sellParams[i]) || null,
                    operator: sellOperators[i],
                    compare_type: sellCompareTypes[i]
                };

                if (sellCompareTypes[i] === 'value') {
                    condition.compare_value = parseFloat(sellCompareValues[i]);
                } else {
                    condition.compare_indicator = sellCompareIndicators[i];
                    condition.compare_param = parseInt(sellCompareParams[i]) || null;
                }

                strategy.sell_conditions.push(condition);
            }

            document.getElementById('output').textContent = JSON.stringify(strategy, null, 2);
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('input[name="strategy_name"]').value = 'EMA Crossover Strategy';
            
            const buyGroup = document.querySelector('#buyConditions .condition-group');
            buyGroup.querySelector('select[name="buy_indicator[]"]').value = 'EMA';
            buyGroup.querySelector('input[name="buy_param1[]"]').value = '50';
            buyGroup.querySelector('select[name="buy_operator[]"]').value = '>';
            buyGroup.querySelector('select[name="buy_compare_type[]"]').value = 'indicator';
            buyGroup.querySelector('select[name="buy_compare_indicator[]"]').value = 'EMA';
            buyGroup.querySelector('input[name="buy_compare_param[]"]').value = '250';

            const sellGroup = document.querySelector('#sellConditions .condition-group');
            sellGroup.querySelector('select[name="sell_indicator[]"]').value = 'EMA';
            sellGroup.querySelector('input[name="sell_param1[]"]').value = '50';
            sellGroup.querySelector('select[name="sell_operator[]"]').value = '<';
            sellGroup.querySelector('select[name="sell_compare_type[]"]').value = 'indicator';
            sellGroup.querySelector('select[name="sell_compare_indicator[]"]').value = 'EMA';
            sellGroup.querySelector('input[name="sell_compare_param[]"]').value = '250';
        });
    </script>
</body>
</html>
